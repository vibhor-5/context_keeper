version: '3.8'

services:
  contextkeeper-mcp-slack-bot:
    build: .
    ports:
      - "3001:3001"  # MCP Server
      - "3002:3002"  # Slack Bot
    environment:
      - NODE_ENV=production
      - MCP_PORT=3001
      - SLACK_PORT=3002
      - GO_BACKEND_URL=http://host.docker.internal:8080
      - LOG_LEVEL=info
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      - contextkeeper-go-backend
    networks:
      - contextkeeper-network

  # Reference to existing Go backend (if running via Docker)
  contextkeeper-go-backend:
    image: contextkeeper-go-backend:latest
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
    networks:
      - contextkeeper-network
    profiles:
      - with-backend

networks:
  contextkeeper-network:
    driver: bridge